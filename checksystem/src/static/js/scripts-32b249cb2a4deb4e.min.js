/*! NightChallenge2015 | SKB Kontur */
Date.prototype.toMinutesTime=function(){function a(a){return""+(9<a?a:"0"+a)}var f=this.getHours(),g=this.getMinutes();return a(f)+":"+a(g)};Date.prototype.toUTCSecondsTime=function(){function a(a){return""+(9<a?a:"0"+a)}var f=this.getUTCHours(),g=this.getUTCMinutes(),h=this.getUTCSeconds();return a(f)+":"+a(g)+":"+a(h)};function fixIEHeight(a){a.height(a.parent().outerHeight())}function htmlEncode(a){return $("<div/>").text(a).html()}var gtimer,END;
function setTimer(a){function f(){var a=new Date,f=END-a+60*a.getTimezoneOffset();0>f&&(f=0);g.text((new Date(f)).toUTCSecondsTime())}END=new Date(a);var g=$(".main-img");gtimer||(gtimer=setInterval(f,1E3))}
$(function(){function a(b){b.stop(!0,!0).animate({scrollTop:b.prop("scrollHeight")},300)}function f(){a($(".chat-history"))}function g(){a($(".files-history"))}function h(b){b.css({"background-color":"rgba(255, 100, 100, 0.25)"}).delay(3E3).animate({backgroundColor:"transparent"},1E3)}function k(){$(".header").append($("<span class='star'></span>"))}function l(){var b=$("<tr class='chat-msg-wait'><td colspan='3'>Waiting for response...</td></tr>");$(".chat-msg-tbl tbody").append(b);$(".chat-history").perfectScrollbar("update");
f()}function m(){$(".chat-msg-wait").remove()}function n(b,c){var a=$("<td class='chat-msg-time'></td>").text(b),d=$("<td colspan='2' class='chat-msg-text chat-msg-question'></td>").html(htmlEncode(c).replace(/\r?\n/g,"<br/>")),e=$("<tr></tr>");e.append(d).append(a);$(".chat-msg-tbl tbody").append(e);$(".chat-history").perfectScrollbar("update");f()}function p(b,c){var a=$("<td class='chat-msg-time'></td>").text(b),d=$("<td colspan='2' class='chat-msg-text'></td>").html(htmlEncode(c).replace(/\r?\n/g,
"<br/>")),e=$("<tr></tr>");e.append(a).append(d);$(".chat-msg-tbl tbody").append(e);$(".chat-history").perfectScrollbar("update");f();h(d)}function q(b){if(!$(".files-history-inner").find(".file[href='"+b.url+"']").length){var c=$("<span class='file-text'></span>").text(b.name);c.append($("<span class='file-ext'></span>").text(b.ext?b.ext:""));var a=$("<a class='file' target='_blank'></a>").attr("href",b.url).append($("<span class='file-img'></span>")).append(c),d=$("<div></div>").append(a);$(".files-history-inner").append(d);
$(".files-history").perfectScrollbar("update");g();h(c)}}function j(a){if(a&&a.length){var c=JSON.parse(a);if(c){c.score&&k();if(c.msgs)for(var i=0;i<c.msgs.length;i++){var d=c.msgs[i];p(d.time,d.text)}if(c.files)for(var e=0;e<c.files.length;e++)q(c.files[e]);c.timer?($(".main-img").addClass("main-img_erth"),setTimer(c.timer)):$(".main-img").removeClass("main-img_erth")}}}$("#js-reg-form").submit(function(a){a.preventDefault();$.ajax({url:"/auth?signup=1",type:"POST",data:$(this).serialize()}).done(function(a){if(a&&
a.length){var b=JSON.parse(a);b&&b.text&&$(".login-warn").html("ACCESS GRANTED<br/>Your password is: "+htmlEncode(b.text)+"<br/><b><a href='/' style='font-size:24px'>ENTER</a></b>")}}).fail(function(a){var b,d=a.responseText;if(d&&d.length){var e=JSON.parse(d);e&&e.error&&(b=e.error)}$("#js-auth-fail").text(b?b:"Unknown error").stop(!0,!0).show(200).delay(3E3).hide(200)})});$("#js-login-form").submit(function(a){a.preventDefault();$.ajax({url:"/auth",type:"POST",data:$(this).serialize()}).done(function(){window.location=
"/"}).fail(function(a){var b,d=a.responseText;if(d&&d.length){var e=JSON.parse(d);e&&e.error&&(b=e.error)}$("#js-auth-fail").text(b?b:"Unknown error").stop(!0,!0).show(200).delay(3E3).hide(200)})});$(".chat-history").perfectScrollbar();$(".files-history").perfectScrollbar();$(".chat-question").keydown(function(a){13==a.which&&a.ctrlKey&&(a.preventDefault(),$("#js-chat").submit())});setInterval(function(){$.ajax({url:"/check",type:"POST"}).done(j)},6E4);$("#js-chat").submit(function(a){a.preventDefault();
$.ajax({url:"/send",type:"POST",data:$(this).serialize()}).done(function(a){a&&a.length&&($(".main-cptn").stop(!0,!0).addClass("main-cptn_talk").delay(4E3).queue(function(){$(".main-cptn").removeClass("main-cptn_talk")}),n((new Date).toMinutesTime(),$(".chat-question").val()),l(),setTimeout(function(){m();j(a)},2E3),$(".chat-question").val(""))}).fail(function(a){var b,d=a.responseText;if(d&&d.length){var e=JSON.parse(d);e&&e.error&&(b=e.error)}$("#js-send-fail").text(b?b:"Unknown error").stop(!0,
!0).show(200).delay(3E3).hide(200)})});$(function(){if(navigator.userAgent.match(/Trident/)){var a=$(".chat-history"),c=$(".files-history");$(window).resize(function(){fixIEHeight(a);fixIEHeight(c)});fixIEHeight(a);fixIEHeight(c)}f();g()})});
